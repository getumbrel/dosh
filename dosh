#!/bin/sh

shell=${DOSH_DEFAULT_SHELL:-bash}
default_image=${DOSH_DEFAULT_IMAGE:-debian:buster-slim}
init_hook=$DOSH_INIT_HOOK

if [[ $@ != -* ]]; then
  user_supplied_image=$1
  shift
fi
image=${user_supplied_image:-$default_image}
docker_run_args=$@

init_script="
cd /workdir

$init_hook

if command -v $shell > /dev/null; then
  exec $shell
else
  exec sh
fi
"

docker run -it --entrypoint sh -v ${PWD}:/workdir $docker_run_args $image -c "$init_script"
